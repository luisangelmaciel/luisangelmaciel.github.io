/*! * Object.observe polyfill - v0.2.4 * by Massimo Artizzu (MaxArt2501) * * https://github.com/MaxArt2501/object-observe * * Licensed under the MIT License * See LICENSE for details */
Object.observe||function(e,t,n,r){"use strict";var o,i,s,c,a,f,u=["add","update","delete","reconfigure","setPrototype","preventExtensions"],p=t.isArray||(f=e.prototype.toString,function(e){return"[object Array]"===f.call(e)}),l=t.prototype.indexOf?t.indexOf||function(e,n,r){return t.prototype.indexOf.call(e,n,r)}:function(e,t,n){for(var r=n||0;r<e.length;r++)if(e[r]===t)return r;return-1},d=void 0!==n.Map&&Map.prototype.forEach?function(){return new Map}:function(){var e=[],t=[];return{size:0,has:function(t){return l(e,t)>-1},get:function(n){return t[l(e,n)]},set:function(n,r){var o=l(e,n);-1===o?(e.push(n),t.push(r),this.size++):t[o]=r},delete:function(n){var r=l(e,n);r>-1&&(e.splice(r,1),t.splice(r,1),this.size--)},forEach:function(n){for(var r=0;r<e.length;r++)n.call(arguments[1],t[r],e[r],this)}}},h=e.getOwnPropertyNames?function(){var t=e.getOwnPropertyNames;try{arguments.callee}catch(r){var n=(t(l).join(" ")+" ").replace(/prototype |length |name /g,"").slice(0,-1).split(" ");n.length&&(t=function(t){var r=e.getOwnPropertyNames(t);if("function"==typeof t)for(var o,i=0;i<n.length;)(o=l(r,n[i++]))>-1&&r.splice(o,1);return r})}return t}():function(t){var n,r,o=[];if("hasOwnProperty"in t)for(n in t)t.hasOwnProperty(n)&&o.push(n);else for(n in r=e.hasOwnProperty,t)r.call(t,n)&&o.push(n);return p(t)&&o.push("length"),o},v=e.getPrototypeOf,b=e.defineProperties&&e.getOwnPropertyDescriptor,y=n.requestAnimationFrame||n.webkitRequestAnimationFrame||(a=+new Date,function(e){return setTimeout(function(){e(+new Date-a)},17)}),g=function(t,n){var r,i=h(t),s=[],c=0;n={handlers:d(),frozen:!!e.isFrozen&&e.isFrozen(t),extensible:!e.isExtensible||e.isExtensible(t),proto:v&&v(t),properties:i,values:s,notifier:z(t,n)};if(b)for(r=n.descriptors=[];c<i.length;)r[c]=b(t,i[c]),s[c]=t[i[c++]];else for(;c<i.length;)s[c]=t[i[c++]];return o.set(t,n),n},j=(s=b?function(e,t,n,r,o){var i=t.properties[n],s=e[i],c=t.values[n],a=t.descriptors[n];"value"in o&&(c===s?0===c&&1/c!=1/s:c==c||s==s)&&(O(e,t,{name:i,type:"update",object:e,oldValue:c},r),t.values[n]=s),!a.configurable||o.configurable&&o.writable===a.writable&&o.enumerable===a.enumerable&&o.get===a.get&&o.set===a.set||(O(e,t,{name:i,type:"reconfigure",object:e,oldValue:c},r),t.descriptors[n]=o)}:function(e,t,n,r){var o=t.properties[n],i=e[o],s=t.values[n];(s===i?0===s&&1/s!=1/i:s==s||i==i)&&(O(e,t,{name:o,type:"update",object:e,oldValue:s},r),t.values[n]=i)},c=b?function(e,t,n,r,o){for(var i,c=t.length;n&&c--;)null!==t[c]&&(n--,(i=b(e,t[c]))?s(e,r,c,o,i):(O(e,r,{name:t[c],type:"delete",object:e,oldValue:r.values[c]},o),r.properties.splice(c,1),r.values.splice(c,1),r.descriptors.splice(c,1)))}:function(e,t,n,r,o){for(var i=t.length;n&&i--;)null!==t[i]&&(O(e,r,{name:t[i],type:"delete",object:e,oldValue:r.values[i]},o),r.properties.splice(i,1),r.values.splice(i,1),n--)},function(t,n,r){if(t.handlers.size&&!t.frozen){var o,i,a,f,u,p,d,y,g=t.values,j=t.descriptors,w=0;if(t.extensible)if(i=(o=t.properties.slice()).length,a=h(n),j){for(;w<a.length;)u=a[w++],f=l(o,u),y=b(n,u),-1===f?(O(n,t,{name:u,type:"add",object:n},r),t.properties.push(u),g.push(n[u]),j.push(y)):(o[f]=null,i--,s(n,t,f,r,y));c(n,o,i,t,r),e.isExtensible(n)||(t.extensible=!1,O(n,t,{type:"preventExtensions",object:n},r),t.frozen=e.isFrozen(n))}else{for(;w<a.length;)u=a[w++],f=l(o,u),p=n[u],-1===f?(O(n,t,{name:u,type:"add",object:n},r),t.properties.push(u),g.push(p)):(o[f]=null,i--,s(n,t,f,r));c(n,o,i,t,r)}else if(!t.frozen){for(;w<o.length;w++)u=o[w],s(n,t,w,r,b(n,u));e.isFrozen(n)&&(t.frozen=!0)}v&&(d=v(n))!==t.proto&&(O(n,t,{type:"setPrototype",name:"__proto__",object:n,oldValue:t.proto}),t.proto=d)}}),w=function(){o.size&&(o.forEach(j),i.forEach(m),y(w))},m=function(e,t){var n=e.changeRecords;n.length&&(e.changeRecords=[],t(n))},z=function(e,t){return arguments.length<2&&(t=o.get(e)),t&&t.notifier||{notify:function(t){t.type;var n=o.get(e);if(n){var r,i={object:e};for(r in t)"object"!==r&&(i[r]=t[r]);O(e,n,i)}},performChange:function(t,n){if("string"!=typeof t)throw new TypeError("Invalid non-string changeType");if("function"!=typeof n)throw new TypeError("Cannot perform non-function");var r,i,s=o.get(e),c=arguments[2],a=void 0===c?n():n.call(c);if(s&&j(s,e,t),s&&a&&"object"==typeof a){for(r in i={object:e,type:t},a)"object"!==r&&"type"!==r&&(i[r]=a[r]);O(e,s,i)}}}},E=function(e,t,n,r){var o=i.get(n);o||i.set(n,o={observed:d(),changeRecords:[]}),o.observed.set(e,{acceptList:r.slice(),data:t}),t.handlers.set(n,o)},O=function(e,t,n,r){t.handlers.forEach(function(t){var o=t.observed.get(e).acceptList;("string"!=typeof r||-1===l(o,r))&&l(o,n.type)>-1&&t.changeRecords.push(n)})};o=d(),i=d(),e.observe=function(t,n,r){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new TypeError("Object.observe cannot observe non-object");if("function"!=typeof n)throw new TypeError("Object.observe cannot deliver to non-function");if(e.isFrozen&&e.isFrozen(n))throw new TypeError("Object.observe cannot deliver to a frozen function object");if(void 0===r)r=u;else if(!r||"object"!=typeof r)throw new TypeError("Third argument to Object.observe must be an array of strings.");return function(e,t,n){var r=o.get(e);r?(j(r,e),E(e,r,t,n)):(r=g(e),E(e,r,t,n),1===o.size&&y(w))}(t,n,r),t},e.unobserve=function(e,t){if(null===e||"object"!=typeof e&&"function"!=typeof e)throw new TypeError("Object.unobserve cannot unobserve non-object");if("function"!=typeof t)throw new TypeError("Object.unobserve cannot deliver to non-function");var n,r=i.get(t);return r&&(n=r.observed.get(e))&&(r.observed.forEach(function(e,t){j(e.data,t)}),y(function(){m(r,t)}),1===r.observed.size&&r.observed.has(e)?i.delete(t):r.observed.delete(e),1===n.data.handlers.size?o.delete(e):n.data.handlers.delete(t)),e},e.getNotifier=function(t){if(null===t||"object"!=typeof t&&"function"!=typeof t)throw new TypeError("Object.getNotifier cannot getNotifier non-object");return e.isFrozen&&e.isFrozen(t)?null:z(t)},e.deliverChangeRecords=function(e){if("function"!=typeof e)throw new TypeError("Object.deliverChangeRecords cannot deliver to non-function");var t=i.get(e);t&&(t.observed.forEach(function(e,t){j(e.data,t)}),m(t,e))}}(Object,Array,this);
